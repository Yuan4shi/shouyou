function TouchScroll(t){this.cfg=this.parseArgs(t),this.container="string"==typeof this.cfg.id?this.$(this.cfg.id):this.cfg.id;try{if(!this.container)throw new Error("Can't find element");for(var i=0,s=this.instances.length;i<s;i++)if(this.instances[i]==this.container)throw new Error("An instance has being running!");this.instances.push(this.container),this.setup()}catch(t){this.error=t.message}}TouchScroll.prototype={_default:{id:"slider",width:4,minLength:20,opacity:.8,onscroll:new Function,ondrag:new Function,color:"black",mouseAlign:1},instances:[],$:function(t){return document.getElementById(t)},$C:function(t,i){var s=document.createElement(t)||null;if(i="[object Object]"==Object.prototype.toString.call(i)?i:{},s)for(var e in i)"style"==e?s.style.cssText+=i[e]:s.setAttribute(e,i[e]);return s},css:function(){var t=function(t){switch(t){case"float":return"cssFloat"in document.body.style?"cssFloat":"styleFloat";case"opacity":return"opacity"in document.body.style?"opacity":{get:function(t,i){var s=i.filter;return s&&s.indexOf("opacity")>=0&&parseFloat(s.match(/opacity=([^)]*)/i)[1])/100+""||"1"},set:function(t,i){t.style.filter="alpha(opacity="+100*i+")",t.style.zoom=1}};default:for(var i=t.split("-"),s=1;s<i.length;s++)i[s]=i[s].substring(0,1).toUpperCase()+i[s].substring(1);return t=i.join("")}},i=function(i,s){s=t(s);var e=i.style[s];if(!e){var h=document.defaultView&&document.defaultView.getComputedStyle&&getComputedStyle(i,null)||i.currentStyle||i.style;e="string"==typeof s?h[s]:s.get(i,h)}return"auto"==e?"":e},s=function(i,s){var e;for(var h in s)e=t(h),"string"==typeof e?i.style[e]=s[h]:e.set(i,s[h])};return function(t,e){return"string"==typeof e?i(t,e):s(t,e)}}(),parseArgs:function(t){var i={},s=Object.prototype.toString;if(t&&"[object Object]"==s.call(t))for(var e in this._default)i[e]="undefined"==typeof t[e]?this._default[e]:"[object Number]"==s.call(this._default[e])?parseInt(100*parseFloat(t[e]))/100:t[e];else i=this._default;return i},addListener:function(t,i,s,e){return t.addEventListener?(t.addEventListener(i,s,e),!0):!!t.attachEvent&&(t.attachEvent("on"+i,s),!0)},getPoint:function(t){t=t||window.event;var i=y=0,s=this.supportsTouches&&t.touches.length?t.touches[0]:t,e=document.documentElement,h=document.body;return window.pageXOffset?(i=window.pageXOffset,y=window.pageYOffset):(i=(e&&e.scrollLeft||h&&h.scrollLeft||0)-(e&&e.clientLeft||h&&h.clientLeft||0),y=(e&&e.scrollTop||h&&h.scrollTop||0)-(e&&e.clientTop||h&&h.clientTop||0)),i+=s.clientX,y+=s.clientY,{x:i,y:y}},preventDefault:function(t){window.event?window.event.returnValue=!1:t.preventDefault()},contains:function(t,i){return t.contains?t!=i&&t.contains(i):!!(16&t.compareDocumentPosition(i))},bind:function(t,i){return function(){return t.apply(i,arguments)}},deleteAll:function(){for(var t=0;t<arguments.length;t++)delete this[arguments[t]]},fixedMouse:function(t,i){var s,e=t.type.toLowerCase();if("mouseover"==e)s=t.relatedTarget||t.fromElement;else{if(!(e="mouseout"))return!0;s=t.relatedTarget||t.toElement}return!s||"xul"!=s.prefix&&!this.contains(i,s)&&s!==i},setup:function(){var t=document.documentElement||document.getElementsByTagName("html")[0];this.supportsTouches="createTouch"in document||"ontouchstart"in window,this.supportsTransition="WebkitTransition"in t.style||"MsTransition"in t.style||"MozTransition"in t.style||"OTransition"in t.style||"transition"in t.style,this.startEvent=this.supportsTouches?"touchstart":"mousedown",this.moveEvent=this.supportsTouches?"touchmove":"mousemove",this.endEvent=this.supportsTouches?"touchend":"mouseup",this.overEvent=this.supportsTouches?"touchstart":"mouseover",this.outEvent=this.supportsTouches?"touchend":"mouseout",this.property=[["left","right","width","clientWidth","scrollWidth","horizontalBar","horizontalScrollBar"],["top","bottom","height","clientHeight","scrollHeight","verticalBar","verticalScrollBar"]],this.timer=[null,null],this.resize(),this.addListener(window,"resize",this.bind(function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.bind(this.resize,this),100)},this),!1),this.addListener(document,this.moveEvent,this.bind(this.move,this),!1),this.addListener(document,this.endEvent,this.bind(this.end,this),!1),this.addListener(this.container,"touchcancel",this.bind(this.end,this),!1),this.addListener(this.container,this.overEvent,this.bind(this.toggleShow,this),!1),this.addListener(this.container,this.outEvent,this.bind(this.toggleShow,this),!1),this.addListener(this.container,"mousewheel",this.bind(this.mouseScroll,this),!1),this.addListener(this.container,"DOMMouseScroll",this.bind(this.mouseScroll,this),!1)},clear:function(){if(this.element){for(this.css(this.container,{visibility:"hidden"});this.element.childNodes.length;)this.container.appendChild(this.element.firstChild);this.container.removeChild(this.wrapper),this.container.scrollLeft=-this.ratio0*(this.container.scrollWidth-this.container.clientWidth),this.container.scrollTop=-this.ratio1*(this.container.scrollHeight-this.container.clientHeight),this.wrapper=this.element=this.horizontalBar=this.verticalBar=this.horizontalScrollBar=this.verticalScrollBar=null,this.css(this.container,{visibility:"visible"})}},resize:function(){this.clear();var t=parseInt(this.css(this.container,"padding-left"))+parseInt(this.css(this.container,"padding-right")),i=parseInt(this.css(this.container,"padding-top"))+parseInt(this.css(this.container,"padding-bottom")),s=this.container.offsetWidth-(parseInt(this.css(this.container,"border-left-width"))||0)-(parseInt(this.css(this.container,"border-right-width"))||0)-this.container.clientWidth,e=this.container.offsetHeight-(parseInt(this.css(this.container,"border-top-width"))||0)-(parseInt(this.css(this.container,"border-bottom-width"))||0)-this.container.clientHeight;for(this.clientWidth=this.container.clientWidth-t+s,this.clientHeight=this.container.clientHeight-i+e,this.scrollWidth=this.container.scrollWidth-t,this.scrollHeight=this.container.scrollHeight-i,this.element=this.$C("div",{class:"touchscrollelement",style:";overflow:hidden;width:"+this.scrollWidth+"px;padding:"+parseInt(e/2)+"px "+parseInt(s/2)+"px;position:absolute;top:-"+this.container.scrollTop+"px;left:-"+this.container.scrollLeft+"px;"}),this.wrapper=this.$C("div",{class:"touchscrollwrapper",style:";overflow:hidden;position:relative;width:100%;height:"+this.clientHeight+"px;"});this.container.childNodes.length;)this.element.appendChild(this.container.firstChild);this.wrapper.appendChild(this.element);var h=";opacity:0;filter:alpha(opacity=0);position:absolute;overflow:hidden;-webkit-transition:opacity 400ms ease-out;-moz-transition:opacity 400ms ease-out;-o-transition:opacity 400ms ease-out;-ms-transition:opacity 400ms ease-out;transition:opacity 400ms ease-out;",n=";position:absolute;width:100%;height:100%;top:0;left:0;background-color:"+this.cfg.color+";-webkit-border-radius:"+this.cfg.width+"px;-moz-border-radius:"+this.cfg.width+"px;border-radius:"+this.cfg.width+"px;";this.horizontalBar=this.$C("div",{class:"touchscrollhorizontal",style:h}),this.verticalBar=this.$C("div",{class:"touchscrollvertical",style:h}),this.horizontalScrollBar=this.$C("div",{class:"touchscrollbar horizontal",style:n}),this.verticalScrollBar=this.$C("div",{class:"touchscrollbar vertical",style:n}),this.horizontalBar.appendChild(this.horizontalScrollBar),this.verticalBar.appendChild(this.verticalScrollBar),this.wrapper.appendChild(this.horizontalBar),this.wrapper.appendChild(this.verticalBar),this.css(this.horizontalBar,{display:this.scrollWidth>this.clientWidth?"block":"none",width:this.clientWidth+"px",left:0,bottom:0,height:this.cfg.width+"px"}),this.css(this.verticalBar,{display:this.scrollHeight>this.clientHeight?"block":"none",height:this.clientHeight+"px",right:0,top:0,width:this.cfg.width+"px"}),this.container.appendChild(this.wrapper),this.scrollHeight=Math.max(this.scrollHeight,this.element.clientHeight),this.scrollWidth=Math.max(this.scrollWidth,this.element.clientWidth),this.refresh(0),this.refresh(1),this.addListener(this.wrapper,this.startEvent,this.bind(this.start,this),!1)},refresh:function(t,i){t=1*!!parseInt(t);var s,e,h,n,r,o,a,l,c,p;l=this[this.property[t][6]],s=this[this.property[t][4]],e=this[this.property[t][3]],h=Math.max(this.cfg.width,this.cfg.minLength),c=parseInt(this.css(this.element,this.property[t][0])),p=s==e?0:parseInt(c/(s-e)*1e3)/1e3,n=Math.max(parseInt(e*e/s),h),c>0?(r=Math.max(this.cfg.width,n-c/e*n),o=0,a="auto"):c<=e-s?(r=Math.max(this.cfg.width,(s+c)/e*n),o="auto",a=0):(r=n,o=-c/(s-e||1)*(e-r)+"px",a="auto"),l.style[this.property[t][2]]=r+"px",l.style[this.property[t][0]]=o,l.style[this.property[t][1]]=a,this["ratio"+t]=p,i&&(this.css(this[this.property[t][5]],{opacity:this.cfg.opacity}),this.css(this[this.property[1-t][5]],{opacity:0})),this.cfg.onscroll.call(this,null)},toggleShow:function(t){if(t=t||window.event,this.wrapper&&(this.fixedMouse(t,this.container)||this.supportsTouches)){var i=t.type,s=0;switch(i){case this.overEvent:s=this.cfg.opacity,this.mouseEnter=!0;break;case this.outEvent:this.mouseEnter=!1;break;default:return!1}this.during||(this.css(this.horizontalBar,{opacity:s}),this.css(this.verticalBar,{opacity:s}))}},_scroll:function(t,i){var s,e,h,n,r,o,a,i,l=40;n=0,s=parseInt(this.css(this.element,this.property[t][0])),h=this[this.property[t][4]]-this[this.property[t][3]],e=s+i,e>0?e>l?(i=l-s,n=-l):n=-e:e<-h&&(e<-h-l?(i=-h-l-s,n=l):n=-h-e),r=400*Math.abs(i)/(Math.abs(i)+Math.abs(n)),a=function(){this.slide(t,n,400-r,"ease-in-out")},this.slide(t,i,r,o,a)},scroll:function(t,i){for(var s=0;s<arguments.length;s++)this._scroll(s,arguments[s])},scrollTo:function(t,i){this.css(this.element,{left:-t+"px",top:-i+"px"}),this.refresh(0),this.refresh(1)},slide:function(t,i,s,e,h){function n(t,i,s,e,h){var n;switch(h){case"ease-in-out":n=(t/=e/2)<1?s/2*t*t*t+i:s/2*((t-=2)*t*t+2)+i;break;default:n=-s*((t=t/e-1)*t*t*t-1)+i}return n}function r(){i&&p<d?(p+=10,o.element.style[o.property[t][0]]=n(p,l,c,d,u)+"px",o.timer[t]=setTimeout(r,10),o.refresh(t,!0)):(o.during=!1,o.element.style[o.property[t][0]]=l+i+"px",o.mouseEnter||h||(o.css(o.horizontalBar,{opacity:0}),o.css(o.verticalBar,{opacity:0})),o.refresh(t),a.call(o,null)),o.deleteAll("timer"+t)}var o=this,a=h||new Function,l=parseInt(this.css(this.element,this.property[t][0])),c=i,p=0,d=s||400,u=e||"ease-out";this.during=!0,clearTimeout(this.timer[t]),r()},start:function(t){clearTimeout(this.timer[0]),clearTimeout(this.timer[1]),this.supportsTouches||this.preventDefault(t),this.element.onclick=null;var i=t&&t.target||window.event.srcElement;3==i.nodeType&&(i=i.parentNode),this.target=i==this.wrapper||i==this.element||this.contains(this.element,i)?0:1,this.startPos=this.getPoint(t),this.elementRect=[parseInt(this.css(this.element,"left")),parseInt(this.css(this.element,"top"))],this.disc=[[new Date],[this.startPos]]},move:function(t){if(!(!this.disc||t.touches&&t.touches.length>1||t.scale&&1!==t.scale)){this.endPos=this.getPoint(t);var i,s,e=[this.endPos.x-this.startPos.x,this.endPos.y-this.startPos.y],h=1;if("undefined"==typeof this.flag&&(this.scrollWidth>this.clientWidth&&Math.abs(e[0])>=Math.abs(e[1])?this.flag=0:this.scrollHeight>this.clientHeight&&Math.abs(e[1])>=Math.abs(e[0])?this.flag=1:this.flag=!1),this.flag!==!1){if(this.preventDefault(t),this.during=!0,s=this[this.property[this.flag][4]]-this[this.property[this.flag][3]],this.target){var n=parseInt(this.css(this[this.property[this.flag][6]],this.property[this.flag][2]));h=-s/(this[this.property[this.flag][3]]-n)}i=this.elementRect[this.flag]+e[this.flag]*h,i>0?i/=i/this[this.property[this.flag][3]]+1:i<-s&&(i+=s,i=i/(Math.abs(i)/this[this.property[this.flag][3]]+1)-s),this.element.style[this.property[this.flag][0]]=i+"px",this.refresh(this.flag,!0),this.disc[0].push(new Date),this.disc[1].push(this.endPos)}}},end:function(t){if(this.disc){if("number"==typeof this.flag){var i,s,e,h,n,r,o;if(i=0,o=this[this.property[this.flag][4]]-this[this.property[this.flag][3]],s=parseInt(this.css(this.element,this.property[this.flag][0])),s>0)i=-s;else if(s<-o)i=-o-s;else if(!this.target){for(e=new Date;this.disc[0].length&&e-this.disc[0][0]>200;)this.disc[0].shift(),this.disc[1].shift();this.disc[0].length&&(r=e-this.disc[0][0],h=[this.endPos.x-this.disc[1][0].x,this.endPos.y-this.disc[1][0].y],n=h[this.flag],Math.abs(n)>20&&(i=(2-r/200)*n))}this.cfg.ondrag.call(this,this.flag,i)!==!1&&this._scroll(this.flag,i),this.element.onclick=new Function("return false;")}this.deleteAll("startPos","endPos","disc","flag","target","elementRect")}},mouseScroll:function(t){this.preventDefault(t),t=t||window.event;var i,s=t.wheelDelta||t.detail&&t.detail*-1||0,e=120,h=this.cfg.mouseAlign;this.wrapper&&s&&(i=s/Math.abs(s),this._scroll(h,i*e))}},window.TouchScroll=TouchScroll;